desc 'test lane'
lane :test do
    sh('echo', 'Test... OK!')
end

platform :ios do
  lane :build do
    create_keychain(
        name: "match_build_keychain",
        password: "meow",
        default_keychain: true,
        unlock: true,
        timeout: 3600,
        lock_when_sleeps: false
    )
      
    # Prepare nativescript app
    sh('tns', 'prepare', 'ios', '--clean', '--release', '--env.production')

    # load appstore certificates via match
    match(
        type: 'appstore',
        keychain_name: 'match_build_keychain',
        keychain_password: 'meow',
        readonly: true
    )
      
    update_project_provisioning(
        xcodeproj: "./platforms/ios/testghactionrelease.xcworkspace",
        profile: ENV['MATCH_PROVISIONING_PROFILE']
    )

    build_app(
        scheme: "testghactionrelease",
        workspace: "./platforms/ios/testghactionrelease.xcworkspace",
        export_method: 'app-store',
        output_directory: 'dist',
        output_name: 'build.ipa'
    )
  end
end
